
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Alerting Rules · prometheus 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="./" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Command Line
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../command-line/">
            
                <a href="../command-line/">
            
                    
                    Command Line
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../command-line/prometheus.html">
            
                <a href="../command-line/prometheus.html">
            
                    
                    Prometheus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../command-line/promtool.html">
            
                <a href="../command-line/promtool.html">
            
                    
                    Promtool
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.3.1" data-path="alerting_rules.html">
            
                <a href="alerting_rules.html">
            
                    
                    Alerting Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="./">
            
                <a href="./">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="https.html">
            
                <a href="https.html">
            
                    
                    HTTPS And Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="promtool.html">
            
                <a href="promtool.html">
            
                    
                    HTTP Configuration For Promtool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="recording_rules.html">
            
                <a href="recording_rules.html">
            
                    
                    Defining Recording Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="template_examples.html">
            
                <a href="template_examples.html">
            
                    
                    Template Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="template_reference.html">
            
                <a href="template_reference.html">
            
                    
                    Template Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="unit_testing_rules.html">
            
                <a href="unit_testing_rules.html">
            
                    
                    Unit Testing For Rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Querying
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../querying/api.html">
            
                <a href="../querying/api.html">
            
                    
                    HTTP API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../querying/basics.html">
            
                <a href="../querying/basics.html">
            
                    
                    Querying Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../querying/examples.html">
            
                <a href="../querying/examples.html">
            
                    
                    Query Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../querying/functions.html">
            
                <a href="../querying/functions.html">
            
                    
                    Query Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../querying/">
            
                <a href="../querying/">
            
                    
                    Querying
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../querying/operators.html">
            
                <a href="../querying/operators.html">
            
                    
                    Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../querying/remote_read_api.html">
            
                <a href="../querying/remote_read_api.html">
            
                    
                    Remote Read API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../feature_flags.html">
            
                <a href="../feature_flags.html">
            
                    
                    Feature Flags
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../federation.html">
            
                <a href="../federation.html">
            
                    
                    Federation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../getting_started.html">
            
                <a href="../getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../http_sd.html">
            
                <a href="../http_sd.html">
            
                    
                    Writing HTTP Service Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../installation.html">
            
                <a href="../installation.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../management_api.html">
            
                <a href="../management_api.html">
            
                    
                    Management API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../migration.html">
            
                <a href="../migration.html">
            
                    
                    Prometheus 3.0 migration guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../stability.html">
            
                <a href="../stability.html">
            
                    
                    API Stability Guarantees
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../storage.html">
            
                <a href="../storage.html">
            
                    
                    Storage
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Alerting Rules</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>Alerting rules allow you to define alert conditions based on Prometheus
expression language expressions and to send notifications about firing alerts
to an external service. Whenever the alert expression results in one or more
vector elements at a given point in time, the alert counts as active for these
elements&apos; label sets.</p>
<h2 id="defining-alerting-rules">Defining alerting rules</h2>
<p>Alerting rules are configured in Prometheus in the same way as <a href="recording_rules.html">recording
rules</a>.</p>
<p>An example rules file with an alert would be:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">groups</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> example
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">team</span><span class="token punctuation">:</span> myteam
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> HighRequestLatency
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> job<span class="token punctuation">:</span>request_latency_seconds<span class="token punctuation">:</span>mean5m<span class="token punctuation">{</span>job=&quot;myjob&quot;<span class="token punctuation">}</span> <span class="token punctuation">&gt;</span> 0.5
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m
    <span class="token key atrule">keep_firing_for</span><span class="token punctuation">:</span> 5m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> page
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> High request latency
</code></pre>
<p>The optional <code>for</code> clause causes Prometheus to wait for a certain duration
between first encountering a new expression output vector element and counting
an alert as firing for this element. In this case, Prometheus will check that
the alert continues to be active during each evaluation for 10 minutes before
firing the alert. Elements that are active, but not firing yet, are in the pending state.
Alerting rules without the <code>for</code> clause will become active on the first evaluation.</p>
<p>There is also an optional <code>keep_firing_for</code> clause that tells Prometheus to keep
this alert firing for the specified duration after the firing condition was last met.
This can be used to prevent situations such as flapping alerts, false resolutions
due to lack of data loss, etc. Alerting rules without the <code>keep_firing_for</code> clause
will deactivate on the first evaluation where the condition is not met (assuming
any optional <code>for</code> duration described above has been satisfied).</p>
<p>The <code>labels</code> clause allows specifying a set of additional labels to be attached
to the alert. Any existing conflicting labels will be overwritten. The label
values can be templated.</p>
<p>The <code>annotations</code> clause specifies a set of informational labels that can be used to store longer additional information such as alert descriptions or runbook links. The annotation values can be templated.</p>
<h3 id="templating">Templating</h3>
<p>Label and annotation values can be templated using <a href="https://prometheus.io/docs/visualization/consoles" target="_blank">console
templates</a>.  The <code>$labels</code>
variable holds the label key/value pairs of an alert instance. The configured
external labels can be accessed via the <code>$externalLabels</code> variable. The
<code>$value</code> variable holds the evaluated value of an alert instance.</p>
<pre class="language-"><code># To insert a firing element&apos;s label values:
{{ $labels.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>labelname</span><span class="token punctuation">&gt;</span></span> }}
# To insert the numeric expression value of the firing element:
{{ $value }}
</code></pre><p>Examples:</p>
<pre class="language-"><code class="lang-yaml"><span class="token key atrule">groups</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> example
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>

  <span class="token comment"># Alert for any instance that is unreachable for &gt;5 minutes.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> InstanceDown
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> up == 0
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> page
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">&quot;Instance {{ $labels.instance }} down&quot;</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&quot;{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.&quot;</span>

  <span class="token comment"># Alert for any instance that has a median request latency &gt;1s.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> APIHighRequestLatency
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> api_http_request_latencies_second<span class="token punctuation">{</span>quantile=&quot;0.5&quot;<span class="token punctuation">}</span> <span class="token punctuation">&gt;</span> 1
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">&quot;High request latency on {{ $labels.instance }}&quot;</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&quot;{{ $labels.instance }} has a median request latency above 1s (current value: {{ $value }}s)&quot;</span>
</code></pre>
<h2 id="inspecting-alerts-during-runtime">Inspecting alerts during runtime</h2>
<p>To manually inspect which alerts are active (pending or firing), navigate to
the &quot;Alerts&quot; tab of your Prometheus instance. This will show you the exact
label sets for which each defined alert is currently active.</p>
<p>For pending and firing alerts, Prometheus also stores synthetic time series of
the form <code>ALERTS{alertname=&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>alert</span> <span class="token attr-name">name</span><span class="token punctuation">&gt;</span></span>&quot;, alertstate=&quot;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pending</span> <span class="token attr-name">or</span> <span class="token attr-name">firing</span><span class="token punctuation">&gt;</span></span>&quot;, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>additional</span> <span class="token attr-name">alert</span> <span class="token attr-name">labels</span><span class="token punctuation">&gt;</span></span>}</code>.
The sample value is set to <code>1</code> as long as the alert is in the indicated active
(pending or firing) state, and the series is marked stale when this is no
longer the case.</p>
<h2 id="sending-alert-notifications">Sending alert notifications</h2>
<p>Prometheus&apos;s alerting rules are good at figuring what is broken <em>right now</em>, but
they are not a fully-fledged notification solution. Another layer is needed to
add summarization, notification rate limiting, silencing and alert dependencies
on top of the simple alert definitions. In Prometheus&apos;s ecosystem, the
<a href="https://prometheus.io/docs/alerting/alertmanager/" target="_blank">Alertmanager</a> takes on this
role. Thus, Prometheus may be configured to periodically send information about
alert states to an Alertmanager instance, which then takes care of dispatching
the right notifications.
Prometheus can be <a href="configuration.md">configured</a> to automatically discover available
Alertmanager instances through its service discovery integrations.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="./" class="navigation navigation-next navigation-unique" aria-label="Next page: Configuration">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Alerting Rules","sort_rank":3,"level":"1.3.1","depth":2,"next":{"title":"Configuration","level":"1.3.2","depth":2,"path":"configuration/index.md","ref":"configuration/index.md","articles":[]},"previous":{"title":"Configuration","level":"1.3","depth":1,"ref":"","articles":[{"title":"Alerting Rules","level":"1.3.1","depth":2,"path":"configuration/alerting_rules.md","ref":"configuration/alerting_rules.md","articles":[]},{"title":"Configuration","level":"1.3.2","depth":2,"path":"configuration/index.md","ref":"configuration/index.md","articles":[]},{"title":"HTTPS And Authentication","level":"1.3.3","depth":2,"path":"configuration/https.md","ref":"configuration/https.md","articles":[]},{"title":"HTTP Configuration For Promtool","level":"1.3.4","depth":2,"path":"configuration/promtool.md","ref":"configuration/promtool.md","articles":[]},{"title":"Defining Recording Rules","level":"1.3.5","depth":2,"path":"configuration/recording_rules.md","ref":"configuration/recording_rules.md","articles":[]},{"title":"Template Examples","level":"1.3.6","depth":2,"path":"configuration/template_examples.md","ref":"configuration/template_examples.md","articles":[]},{"title":"Template Reference","level":"1.3.7","depth":2,"path":"configuration/template_reference.md","ref":"configuration/template_reference.md","articles":[]},{"title":"Unit Testing For Rules","level":"1.3.8","depth":2,"path":"configuration/unit_testing_rules.md","ref":"configuration/unit_testing_rules.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"prometheus 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"configuration/alerting_rules.md","mtime":"2025-11-01T02:00:08.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-11-01T02:00:34.252Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

