
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Query Examples · prometheus 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="functions.html" />
    
    
    <link rel="prev" href="basics.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Command Line
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../command-line/">
            
                <a href="../command-line/">
            
                    
                    Command Line
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../command-line/prometheus.html">
            
                <a href="../command-line/prometheus.html">
            
                    
                    Prometheus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../command-line/promtool.html">
            
                <a href="../command-line/promtool.html">
            
                    
                    Promtool
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../configuration/alerting_rules.html">
            
                <a href="../configuration/alerting_rules.html">
            
                    
                    Alerting Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../configuration/">
            
                <a href="../configuration/">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../configuration/https.html">
            
                <a href="../configuration/https.html">
            
                    
                    HTTPS And Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../configuration/promtool.html">
            
                <a href="../configuration/promtool.html">
            
                    
                    HTTP Configuration For Promtool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../configuration/recording_rules.html">
            
                <a href="../configuration/recording_rules.html">
            
                    
                    Defining Recording Rules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../configuration/template_examples.html">
            
                <a href="../configuration/template_examples.html">
            
                    
                    Template Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../configuration/template_reference.html">
            
                <a href="../configuration/template_reference.html">
            
                    
                    Template Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../configuration/unit_testing_rules.html">
            
                <a href="../configuration/unit_testing_rules.html">
            
                    
                    Unit Testing For Rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Querying
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="api.html">
            
                <a href="api.html">
            
                    
                    HTTP API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="basics.html">
            
                <a href="basics.html">
            
                    
                    Querying Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.3" data-path="examples.html">
            
                <a href="examples.html">
            
                    
                    Query Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="functions.html">
            
                <a href="functions.html">
            
                    
                    Query Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="./">
            
                <a href="./">
            
                    
                    Querying
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="operators.html">
            
                <a href="operators.html">
            
                    
                    Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="remote_read_api.html">
            
                <a href="remote_read_api.html">
            
                    
                    Remote Read API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../feature_flags.html">
            
                <a href="../feature_flags.html">
            
                    
                    Feature Flags
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../federation.html">
            
                <a href="../federation.html">
            
                    
                    Federation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../getting_started.html">
            
                <a href="../getting_started.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../http_sd.html">
            
                <a href="../http_sd.html">
            
                    
                    Writing HTTP Service Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../installation.html">
            
                <a href="../installation.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../management_api.html">
            
                <a href="../management_api.html">
            
                    
                    Management API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../migration.html">
            
                <a href="../migration.html">
            
                    
                    Prometheus 3.0 migration guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../prometheus_agent.html">
            
                <a href="../prometheus_agent.html">
            
                    
                    Prometheus Agent Mode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../stability.html">
            
                <a href="../stability.html">
            
                    
                    API Stability Guarantees
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../storage.html">
            
                <a href="../storage.html">
            
                    
                    Storage
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Query Examples</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="simple-time-series-selection">Simple time series selection</h2>
<p>Return all time series with the metric <code>http_requests_total</code>:</p>
<pre class="language-"><code>http_requests_total
</code></pre><p>Return all time series with the metric <code>http_requests_total</code> and the given
<code>job</code> and <code>handler</code> labels:</p>
<pre class="language-"><code>http_requests_total{job=&quot;apiserver&quot;, handler=&quot;/api/comments&quot;}
</code></pre><p>Return a whole range of time (in this case 5 minutes up to the query time)
for the same vector, making it a <a href="../basics#range-vector-selectors">range vector</a>:</p>
<pre class="language-"><code>http_requests_total{job=&quot;apiserver&quot;, handler=&quot;/api/comments&quot;}[5m]
</code></pre><p>Note that an expression resulting in a range vector cannot be graphed directly,
but viewed in the tabular (&quot;Console&quot;) view of the expression browser.</p>
<p>Using <a href="basics.html#regular-expressions">regular expressions</a>, you could select time series only for jobs whose
name match a certain pattern, in this case, all jobs that end with <code>server</code>:</p>
<pre class="language-"><code>http_requests_total{job=~&quot;.*server&quot;}
</code></pre><p>To select all HTTP status codes except 4xx ones, you could run:</p>
<pre class="language-"><code>http_requests_total{status!~&quot;4..&quot;}
</code></pre><h2 id="subquery">Subquery</h2>
<p>Return the 5-minute <a href="functions.html#rate">rate</a> of the <code>http_requests_total</code> metric for the past 30 minutes, with a resolution of 1 minute.</p>
<pre class="language-"><code>rate(http_requests_total[5m])[30m:1m]
</code></pre><p>This is an example of a nested subquery. The subquery for the <code>deriv</code> function uses the default resolution. Note that using subqueries unnecessarily is unwise.</p>
<pre class="language-"><code>max_over_time(deriv(rate(distance_covered_total[5s])[30s:5s])[10m:])
</code></pre><h2 id="using-functions-operators-etc">Using functions, operators, etc.</h2>
<p>Return the per-second rate for all time series with the <code>http_requests_total</code>
metric name, as measured over the last 5 minutes:</p>
<pre class="language-"><code>rate(http_requests_total[5m])
</code></pre><p>Assuming that the <code>http_requests_total</code> time series all have the labels <code>job</code>
(fanout by job name) and <code>instance</code> (fanout by instance of the job), we might
want to sum over the rate of all instances, so we get fewer output time series,
but still preserve the <code>job</code> dimension:</p>
<pre class="language-"><code>sum by (job) (
  rate(http_requests_total[5m])
)
</code></pre><p>If we have two different metrics with the same dimensional labels, we can apply
binary operators to them and elements on both sides with the same label set
will get matched and propagated to the output. For example, this expression
returns the unused memory in MiB for every instance (on a fictional cluster
scheduler exposing these metrics about the instances it runs):</p>
<pre class="language-"><code>(instance_memory_limit_bytes - instance_memory_usage_bytes) / 1024 / 1024
</code></pre><p>The same expression, but summed by application, could be written like this:</p>
<pre class="language-"><code>sum by (app, proc) (
  instance_memory_limit_bytes - instance_memory_usage_bytes
) / 1024 / 1024
</code></pre><p>If the same fictional cluster scheduler exposed CPU usage metrics like the
following for every instance:</p>
<pre class="language-"><code>instance_cpu_time_ns{app=&quot;lion&quot;, proc=&quot;web&quot;, rev=&quot;34d0f99&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;}
instance_cpu_time_ns{app=&quot;elephant&quot;, proc=&quot;worker&quot;, rev=&quot;34d0f99&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;}
instance_cpu_time_ns{app=&quot;turtle&quot;, proc=&quot;api&quot;, rev=&quot;4d3a513&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;}
instance_cpu_time_ns{app=&quot;fox&quot;, proc=&quot;widget&quot;, rev=&quot;4d3a513&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;}
...
</code></pre><p>...we could get the top 3 CPU users grouped by application (<code>app</code>) and process
type (<code>proc</code>) like this:</p>
<pre class="language-"><code>topk(3, sum by (app, proc) (rate(instance_cpu_time_ns[5m])))
</code></pre><p>Assuming this metric contains one time series per running instance, you could
count the number of running instances per application like this:</p>
<pre class="language-"><code>count by (app) (instance_cpu_time_ns)
</code></pre><p>If we are exploring some metrics for their labels, to e.g. be able to aggregate
over some of them, we could use the following:</p>
<pre class="language-"><code>limitk(10, app_foo_metric_bar)
</code></pre><p>Alternatively, if we wanted the returned timeseries to be more evenly sampled,
we could use the following to get approximately 10% of them:</p>
<pre class="language-"><code>limit_ratio(0.1, app_foo_metric_bar)
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="basics.html" class="navigation navigation-prev " aria-label="Previous page: Querying Basics">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="functions.html" class="navigation navigation-next " aria-label="Next page: Query Functions">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Query Examples","nav_title":"Examples","sort_rank":4,"level":"1.4.3","depth":2,"next":{"title":"Query Functions","level":"1.4.4","depth":2,"path":"querying/functions.md","ref":"querying/functions.md","articles":[]},"previous":{"title":"Querying Basics","level":"1.4.2","depth":2,"path":"querying/basics.md","ref":"querying/basics.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"prometheus 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"querying/examples.md","mtime":"2026-02-19T02:44:34.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2026-02-19T02:45:02.316Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

